!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).scrollama=t()}(this,function(){"use strict";return function(){let i={},t={},s=[],n=0,o=0,r=0,a=!1,f=!1,c=!1,l=!1,p;const u=[];function d(e){console.error(`scrollama error: ${e}`)}function g(){i={stepEnter:()=>{},stepExit:()=>{},stepProgress:()=>{}},t={}}function m(e){return+e.getAttribute("data-scrollama-index")}function h(){Object.entries(t).forEach(e=>t[e].forEach(e=>e.disconnect()))}function x(){o=window.innerHeight,a&&(s=s.map(e=>({...e,height:e.node.offsetHeight})),f&&y())}function e(e){if(e&&!f){if(!a)return d("scrollama error: enable() called before scroller was ready"),void(f=!1);y()}!e&&f&&h(),f=e}function v(e,t){var n=m(e);const o=stepStates[n];var r,s={element:e,index:n,direction:t};o.direction=t,o.state="enter",u[n]||i.stepEnter(s),l&&(u[n]=!0),c&&(e=m(n=e),void 0!==r&&(stepStates[e].progress=r),n={element:n,index:e,progress:stepStates[e].progress},"enter"===stepStates[e].state&&i.stepProgress(n))}function b([e]){var t=m(e.target);s[t].height=e.target.offsetHeight}function w([e]){window.pageYOffset>r?p="down":window.pageYOffset<r&&(p="up"),r=window.pageYOffset;var{isIntersecting:t,intersectionRatio:n,target:e}=e;console.log(m(e),t,n),(t?v:function(e,t){var n=m(e);const o=stepStates[n];o.state&&(n={element:e,index:n,direction:t},o.direction=t,o.state="exit",i.stepExit(n))})(e,p)}function y(){h(),t.resize=s.map(e=>{const t=new ResizeObserver(b);return t.observe(e.node),t}),t.step=s.map(e=>{var t=(o-e.height)/2;const n=new IntersectionObserver(w,{rootMargin:`-${t}px 0px -${t}px 0px`,threshold:.5});return n.observe(e.node),n})}function E(e){return!(!e||1!==e.nodeType)&&(t=e,("scroll"===(n=window.getComputedStyle(t)).overflowY||"auto"===n.overflowY)&&t.scrollHeight>t.clientHeight?e:E(e.parentNode));var t,n}const S={};return S.setup=({step:e,offset:t=.5,progress:n=!1,once:o=!1})=>{var r;return s=(r=e,e=document,("string"==typeof r?Array.from(e.querySelectorAll(r)):r instanceof Element?[r]:r instanceof NodeList?Array.from(r):r instanceof Array?r:[]).map((e,t)=>({node:e,index:t,direction:void 0,state:void 0,progress:0}))),s.length?(g(),s.reduce((e,t)=>e||E(t.parentNode),!1)&&d("scrollama error: step elements cannot be children of a scrollable element. Remove any css on the parent element with overflow: scroll; or overflow: auto; on elements with fixed height."),c=n,l=o,S.offsetTrigger(t),a=!0,s.forEach(e=>e.node.setAttribute("data-scrollama-index",e.index)),x(),S.enable()):d("no step elements"),S},S.resize=()=>(x(),S),S.enable=()=>(e(!0),S),S.disable=()=>(e(!1),S),S.destroy=()=>{e(!1),g()},S.offsetTrigger=e=>{return null==e?n:(n="number"==typeof e?(1<e&&d("offset value is greater than 1. Fallback to 1."),e<0&&d("offset value is lower than 0. Fallback to 0."),Math.min(Math.max(0,e),1)):"string"==typeof e&&0<e.indexOf("px")?(e=+e.replace("px",""),isNaN(e)?(d("offset value must be in 'px' format. Fallback to 0.5."),.5):e):(d("offset value does not include 'px'. Fallback to 0.5."),.5),S)},S.onStepEnter=e=>("function"==typeof e?i.stepEnter=e:d("onStepEnter requires a function"),S),S.onStepExit=e=>("function"==typeof e?i.stepExit=e:d("onStepExit requires a function"),S),S.onStepProgress=e=>("function"==typeof e?i.stepProgress=e:d("onStepProgress requires a function"),S),S}});
