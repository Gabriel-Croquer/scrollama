!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).scrollama=t()}(this,function(){"use strict";return function(){let o={},i=[],s,n=0,a=0,r,t=!1,f=!1,c=!1,p=[];function u(e){console.error(`scrollama error: ${e}`)}function l(){o={stepEnter:()=>{},stepExit:()=>{},stepProgress:()=>{}},p=[]}function d(e){return+e.getAttribute("data-scrollama-index")}function e(e){e&&!t&&w(),!e&&t&&O(),t=e}function g(e){if("string"==typeof e&&0<e.indexOf("px")){var t=+e.replace("px","");return isNaN(t)?(u("offset value must be in 'px' format. Fallback to 0.5."),{format:"percent",value:.5}):{format:"pixels",value:t}}return"number"!=typeof e&&isNaN(+e)?null:(1<e&&u("offset value is greater than 1. Fallback to 1."),e<0&&u("offset value is lower than 0. Fallback to 0."),{format:"percent",value:Math.min(Math.max(0,e),1)})}function h([e]){var t=d(e.target);const n=i[t];e=e.target.offsetHeight;e!==n.height&&(n.height=e,y(n),b(n),m(n))}function v([e]){window.pageYOffset>n?r="down":window.pageYOffset<n&&(r="up"),n=window.pageYOffset;var{isIntersecting:t,target:e}=e;(t?function(e,t){var n=d(e);const r=i[n];e={element:e,index:n,direction:t},r.direction=t,r.state="enter",p[n]||o.stepEnter(e),c&&(p[n]=!0)}:function(e,t){var n=d(e);const r=i[n];r.state&&(n={element:e,index:n,direction:t},r.direction=t,r.state="exit",o.stepExit(n))})(e,r)}function x([e]){var t=d(e.target),n=i[t],{isIntersecting:r,intersectionRatio:t,target:e}=e;r&&"enter"===n.state&&(n=t,e=d(t=e),void 0!==n&&(i[e].progress=n),t={element:t,index:e,progress:i[e].progress},"enter"===i[e].state&&o.stepProgress(t))}function m(e){const t=new ResizeObserver(h);t.observe(e.node),e.observers.resize=t}function b(e){var t=window.innerHeight,n=e.offset||s,r="pixels"===n.format?1:t,r=n.value*r,t=e.height/2-(t-r),r=e.height/2-r;const o=new IntersectionObserver(v,{rootMargin:`${t}px 0px ${r}px 0px`,threshold:.5});o.observe(e.node),e.observers.step=o}function E(e){var t=window.innerHeight,n=e.offset||s,r="pixels"===n.format?1:t,r=n.value*r,t=`${e.height-(t-r)}px 0px ${-r}px 0px`,r=function(e){var t=Math.ceil(e/a);const n=[];var r=1/t;for(let e=0;e<t+1;e+=1)n.push(e*r);return n}(e.height);const o=new IntersectionObserver(x,{rootMargin:t,threshold:r});o.observe(e.node),e.observers.progress=o}function w(){O(),i.forEach(m),i.forEach(b),f&&i.forEach(E)}function y({observers:t}){Object.keys(t).map(e=>{t[e].disconnect()})}function O(){i.forEach(y)}const S={};return S.setup=({step:e,offset:t=.5,threshold:n=4,progress:r=!1,once:o=!1})=>{var s;return i=(s=e,e=document,("string"==typeof s?Array.from(e.querySelectorAll(s)):s instanceof Element?[s]:s instanceof NodeList?Array.from(s):s instanceof Array?s:[]).map((e,t)=>({index:t,direction:void 0,height:e.offsetHeight,node:e,observers:{},offset:g(e.dataset.offset),progress:0,state:void 0}))),i.length?(f=r,c=o,a=Math.max(1,+n),l(),i.forEach(e=>e.node.setAttribute("data-scrollama-index",e.index)),S.offsetTrigger(t),S.enable()):u("no step elements"),S},S.resize=()=>(i=i.map(e=>({...e,height:e.node.offsetHeight})),t&&w(),S),S.enable=()=>(e(!0),S),S.disable=()=>(e(!1),S),S.destroy=()=>{e(!1),l()},S.offsetTrigger=e=>null==e?s.value:(s=g(e),S),S.onStepEnter=e=>("function"==typeof e?o.stepEnter=e:u("onStepEnter requires a function"),S),S.onStepExit=e=>("function"==typeof e?o.stepExit=e:u("onStepExit requires a function"),S),S.onStepProgress=e=>("function"==typeof e?o.stepProgress=e:u("onStepProgress requires a function"),S),S}});
