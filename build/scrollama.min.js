!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).scrollama=t()}(this,function(){"use strict";return function(){let o={},i=[],s,e=0,a=0,n,t=!1,f=!1,c=!1,p=[];function u(e){console.error(`scrollama error: ${e}`)}function l(){o={stepEnter:()=>{},stepExit:()=>{},stepProgress:()=>{}},p=[]}function d(e){return+e.getAttribute("data-scrollama-index")}function g(){window.pageYOffset>e?n="down":window.pageYOffset<e&&(n="up"),e=window.pageYOffset}function r(e){e&&!t&&O(),!e&&t&&A(),t=e}function h(e){if("string"==typeof e&&0<e.indexOf("px")){var t=+e.replace("px","");return isNaN(t)?(u("offset value must be in 'px' format. Fallback to 0.5."),{format:"percent",value:.5}):{format:"pixels",value:t}}return"number"!=typeof e&&isNaN(+e)?null:(1<e&&u("offset value is greater than 1. Fallback to 1."),e<0&&u("offset value is lower than 0. Fallback to 0."),{format:"percent",value:Math.min(Math.max(0,e),1)})}function v(e,t){var n=d(e);void 0!==t&&(i[n].progress=t);e={element:e,index:n,progress:i[n].progress};"enter"===i[n].state&&o.stepProgress(e)}function x([e]){var t=d(e.target);const n=i[t];e=e.target.offsetHeight;e!==n.height&&(n.height=e,S(n),E(n),w(n))}function m([e]){g();var{isIntersecting:t,target:e}=e;(t?function(e,t){var n=d(e);const r=i[n];e={element:e,index:n,direction:t},r.direction=t,r.state="enter",p[n]||o.stepEnter(e),c&&(p[n]=!0)}:function(e,t){var n=d(e);const r=i[n];r.state&&(n={element:e,index:n,direction:t},f&&("down"===t&&r.progress<1?v(e,1):"up"===t&&0<r.progress&&v(e,0)),r.direction=t,r.state="exit",o.stepExit(n))})(e,n)}function b([e]){g();var t=d(e.target),n=i[t],{isIntersecting:r,intersectionRatio:t,target:e}=e;r&&"enter"===n.state&&v(e,t)}function w(e){const t=new ResizeObserver(x);t.observe(e.node),e.observers.resize=t}function E(e){var t=window.innerHeight,n=e.offset||s,r="pixels"===n.format?1:t,n=n.value*r,r=e.height/2-n,n=e.height/2-(t-n);const o=new IntersectionObserver(m,{rootMargin:`${r}px 0px ${n}px 0px`,threshold:.5});o.observe(e.node),e.observers.step=o}function y(e){var t=window.innerHeight,n=e.offset||s,r="pixels"===n.format?1:t,r=n.value*r,r=`${-r+e.height}px 0px ${r-t}px 0px`,t=function(e){var t=Math.ceil(e/a);const n=[];var r=1/t;for(let e=0;e<t+1;e+=1)n.push(e*r);return n}(e.height);const o=new IntersectionObserver(b,{rootMargin:r,threshold:t});o.observe(e.node),e.observers.progress=o}function O(){A(),i.forEach(w),i.forEach(E),f&&i.forEach(y)}function S({observers:t}){Object.keys(t).map(e=>{t[e].disconnect()})}function A(){i.forEach(S)}const M={};return M.setup=({step:e,offset:t=.5,threshold:n=4,progress:r=!1,once:o=!1})=>{var s;return i=(s=e,e=document,("string"==typeof s?Array.from(e.querySelectorAll(s)):s instanceof Element?[s]:s instanceof NodeList?Array.from(s):s instanceof Array?s:[]).map((e,t)=>({index:t,direction:void 0,height:e.offsetHeight,node:e,observers:{},offset:h(e.dataset.offset),progress:0,state:void 0}))),i.length?(f=r,c=o,a=Math.max(1,+n),l(),i.forEach(e=>e.node.setAttribute("data-scrollama-index",e.index)),M.offsetTrigger(t),M.enable()):u("no step elements"),M},M.resize=()=>(i=i.map(e=>({...e,height:e.node.offsetHeight})),t&&O(),M),M.enable=()=>(r(!0),M),M.disable=()=>(r(!1),M),M.destroy=()=>{r(!1),l()},M.offsetTrigger=e=>null==e?s.value:(s=h(e),M),M.onStepEnter=e=>("function"==typeof e?o.stepEnter=e:u("onStepEnter requires a function"),M),M.onStepExit=e=>("function"==typeof e?o.stepExit=e:u("onStepExit requires a function"),M),M.onStepProgress=e=>("function"==typeof e?o.stepProgress=e:u("onStepProgress requires a function"),M),M}});
